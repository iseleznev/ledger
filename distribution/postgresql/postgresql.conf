# PostgreSQL конфигурация для Docker разработки
# Оптимизировано для MacBook M3 Max

# === ПАМЯТЬ ===
shared_buffers = 256MB                    # 25% от выделенной памяти контейнера
maintenance_work_mem = 512MB              # Для создания индексов
effective_cache_size = 1GB                # Предполагаемый кэш ОС
work_mem = 32MB                          # Для сортировки и хэш-таблиц

# === ПЛАНИРОВЩИК ===
random_page_cost = 1.1                   # Для SSD
effective_io_concurrency = 200           # Для SSD

# === WAL (Write-Ahead Logging) ===
wal_buffers = 16MB
checkpoint_completion_target = 0.9
max_wal_size = 2GB
min_wal_size = 512MB

# === РАЗРАБОТКА (небезопасно для продакшна!) ===
fsync = off                              # Отключаем синхронизацию с диском
synchronous_commit = off                 # Асинхронные коммиты
full_page_writes = off                   # Отключаем полную запись страниц

# === ПОДКЛЮЧЕНИЯ ===
max_connections = 100
shared_preload_libraries = 'pg_stat_statements'

# === ЛОГИРОВАНИЕ ===
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_statement = 'all'                    # Логируем все SQL
log_duration = on
log_min_duration_statement = 100         # Логируем запросы > 100ms

# === СТАТИСТИКА ===
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all

# === АВТОВАКУУМ ===
autovacuum = on
autovacuum_naptime = 60s
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50

# === ЛОКАЛИЗАЦИЯ ===
timezone = 'UTC'
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'